
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Expected Opportunity Loss &#8212; Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Scribbles/ExpectedOpportunityLoss';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Medical Test Accuracy" href="MedicalTestAccuracy.html" />
    <link rel="prev" title="Expectations" href="Expectations.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/og-image.png" class="logo__image only-light" alt="Notebooks - Home"/>
    <script>document.write(`<img src="../_static/og-image.png" class="logo__image only-dark" alt="Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Collapsed Wave Notebooks
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Quantum</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Quantum/QuantumErrorCorrectionWithQiskit.html">Quantum Error Correction</a></li>




<li class="toctree-l1"><a class="reference internal" href="../Quantum/MetropolisHastingsAppliedToADoublet.html">Metropolis Hastings applied to a Doublet</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Scribbles</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Expectations.html">Expectations</a></li>





<li class="toctree-l1 current active"><a class="current reference internal" href="#">Expected Opportunity Loss</a></li>




<li class="toctree-l1"><a class="reference internal" href="MedicalTestAccuracy.html">Medical Test Accuracy</a></li>





<li class="toctree-l1"><a class="reference internal" href="Monocrata.html">Monocrata</a></li>


<li class="toctree-l1"><a class="reference internal" href="MultiArmedBandit.html">Multi Armed Bandit</a></li>




<li class="toctree-l1"><a class="reference internal" href="MutualInformation.html">Mutual Information</a></li>
<li class="toctree-l1"><a class="reference internal" href="PhasePlanes.html">Phase Planes</a></li>






<li class="toctree-l1"><a class="reference internal" href="ApproximatingPIviaMonteCarlo.html">Approximating <span class="math notranslate nohighlight">\(\pi\)</span> via Monte Carlo</a></li>



<li class="toctree-l1"><a class="reference internal" href="SigmoidVsExponential.html">Sigmoid vs Exponential Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="SparseMatrixOperations.html">Example matrix</a></li>




<li class="toctree-l1"><a class="reference internal" href="Sperners_Lemma.html">Sperner’s Lemma: Methodology for splitting <span class="math notranslate nohighlight">\(a\)</span> assets fairly between <span class="math notranslate nohighlight">\(n\)</span> people</a></li>
<li class="toctree-l1"><a class="reference internal" href="TimeComplexityProfiling.html">Time Complexity Profiling</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FScribbles/ExpectedOpportunityLoss.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Scribbles/ExpectedOpportunityLoss.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Expected Opportunity Loss</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Expected Opportunity Loss</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-1-endorsements">Study Case 1: Endorsements</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-2-distribution-centers">Study Case 2: Distribution Centers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-3-boeing-buybacks-decision">Study case 3: Boeing buybacks decision</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#do-you-have-another-study-case-reach-out-for-us-to-discuss-it">Do you have another study case? Reach out for us to discuss it</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p>This methodology is thoroughly described in Douglas Hubbard’s book “How to Measure Anything” . This is the best source if you want to learn more about this topic.</p>
<p>The objective of this notebook is to provide a framework for calculating the value of information. To be more specific, there are many unknowns impacting a decision. This framework allows us how much value exists in reducing the uncertainty around a certain unknown.</p>
<section class="tex2jax_ignore mathjax_ignore" id="expected-opportunity-loss">
<h1>Expected Opportunity Loss<a class="headerlink" href="#expected-opportunity-loss" title="Link to this heading">#</a></h1>
<p>Many decisions are influenced by unknown events. After the event we often realise we could have made better choices. This is known as an opportunity loss: We didn’t make the most of the situation because we didn’t know better at the time.</p>
<p>Even though we cannot remove all the randomness of the world, it is possible to quantify our unknowns and understand under which scenarions we will be missing out on some profits, and when it is worth reducing the uncertainty of our predictions. In this booklet we will be using Douglas’ framework of Expected Opportunity Loss.</p>
<p>For the given framework, I implemented the class above which requires 2 inputs only in order to be initialized:</p>
<ul class="simple">
<li><p><strong>Random inputs:</strong> random number generators that model the inputs for the loss function. The random number generators that take a single integer <span class="math notranslate nohighlight">\(n\)</span> and return <span class="math notranslate nohighlight">\(n\)</span> observations of that input.</p></li>
<li><p><strong>Reward Functions:</strong> Functions that convert an observation from the random number generators into a reward amount.</p></li>
</ul>
<p>The class internally applies a Monte Carlo Simulation to model the Expected Opportunity Loss using this general framework</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;display.precision&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">tqdm</span><span class="o">.</span><span class="n">pandas</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">ExpectedOpportunityLoss</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Monte Carlo Simulation Class that models expected loss using a list of random value generators and reward functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reward_functions</span><span class="p">,</span> <span class="n">random_inputs</span><span class="p">,</span> <span class="n">run_default_script</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param reward_functions: {str: function}</span>
<span class="sd">            Deterministic reward function that takes a single dictionary as input, whose keys are a subset of the keys in the random_inputs passed.</span>
<span class="sd">        :param random_inputs: {str: random_generator}</span>
<span class="sd">            dictionary of random number generators. These are functions that take a single integer input n and return an array of n randomly</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">reward_functions</span><span class="p">,</span> <span class="nb">dict</span>
        <span class="p">),</span> <span class="s2">&quot;reward_functions must be a dictionary&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">random_inputs</span><span class="p">,</span> <span class="nb">dict</span>
        <span class="p">),</span> <span class="s2">&quot;random_value_generators must be a dictionary&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reward_functions</span> <span class="o">=</span> <span class="n">reward_functions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span> <span class="o">=</span> <span class="n">random_inputs</span>  <span class="c1"># TODO: Allow for dependence of variables in the ramdom inputs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">reward_functions</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>
            <span class="o">+</span> <span class="p">[</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">]</span>
            <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;Optimal Decision&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colour_map</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">run_default_script</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">main_script</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">main_script</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_data_points</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>

        <span class="n">display</span><span class="p">(</span>
            <span class="n">HTML</span><span class="p">(</span>
                <span class="s2">&quot;&lt;h1&gt;Expected Loss and Standard Deviation for each option available&lt;/h1&gt;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">generate_metrics</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">()))</span>

        <span class="n">display</span><span class="p">(</span>
            <span class="n">HTML</span><span class="p">(</span>
                <span class="s2">&quot;&lt;h1&gt;Expected savings by knowing the inputs quantiles. The input with higher savings is more promising for making a better decision&lt;/h1&gt;&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">render</span><span class="p">()))</span>

        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;h1&gt;Optimal Choices for each quantile / option&lt;/h1&gt;&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">random_input</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span><span class="p">):</span>
            <span class="n">display</span><span class="p">(</span>
                <span class="n">HTML</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_optimal_choice_per_group</span><span class="p">(</span><span class="n">random_input</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">to_html</span><span class="p">())</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add_data_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">new_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">random_input</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">random_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">reward_function</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reward_functions</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="n">new_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">reward_function</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;Optimal Decision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">max</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="n">new_data</span><span class="p">[</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">new_data</span><span class="p">[</span><span class="s2">&quot;Optimal Decision&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">new_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">new_data</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_generate_single_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the expected_loss and std_deviation for a single option</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;Expected Loss&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span><span class="p">]),</span>
            <span class="s2">&quot;Standard Deviation&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span><span class="p">]),</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">generate_metrics</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the metrics table.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span><span class="n">option</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_single_metric</span><span class="p">(</span><span class="n">option</span><span class="p">)</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;Expected Loss&quot;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Expected Loss&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#d65f5f&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Metrics for the evaluation of which random inputs are worth decreasing the uncertainty of</span>

<span class="sd">        :param bins: integer</span>
<span class="sd">        Number of bins to divide the inputs in. Too small a value might cause you to miss certain relations. Too small a value might cause you to overfit to the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">savings</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">random_input</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s2">&quot;Expected Loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
            <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expected_loss_given_group</span><span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">random_input</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">random_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">savings_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Savings&quot;</span><span class="p">:</span> <span class="n">savings</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">savings_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;Savings&quot;</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#5fba7d&quot;</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metrics</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="s2">&quot;Expected Loss&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_optimal_choices_per_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a Dictionary of Optimal Choices per Group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[[</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">]]</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
            <span class="o">.</span><span class="n">progress_apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
            <span class="o">.</span><span class="n">idxmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_expected_loss_given_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the expected loss assuming we know exactly in which group we are from the passed Series.</span>
<span class="sd">        The series must map the indices in cls.data to the categorical groups</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">optimal_choices_per_group</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optimal_choices_per_group</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="n">optimal_choices_per_group</span><span class="p">[</span><span class="n">groups</span><span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">name</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_optimal_choice_per_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_input</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">random_input</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_inputs</span>
        <span class="p">),</span> <span class="s2">&quot;The selected input is invalid. Make sure you typed it correctly, or check in the randow_inputs attribute which ones are available&quot;</span>
        <span class="n">optimal_choices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_optimal_choices_per_group</span><span class="p">(</span>
            <span class="n">groups</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">random_input</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">duplicates</span><span class="o">=</span><span class="s2">&quot;drop&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">optimal_choices</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">17</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">optimal_choices</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>  <span class="c1"># Removes the opportunity loss part of the string</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Optimal Choice for &quot;</span> <span class="o">+</span> <span class="n">random_input</span><span class="p">:</span> <span class="n">optimal_choices</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">plot_loss_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots the loss function to</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">options</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">options</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="k">assert</span> <span class="nb">set</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">options</span>
        <span class="p">),</span> <span class="s2">&quot;You passed choices that were not part of this object&#39;s initialization&quot;</span>
        <span class="n">loss_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">option</span> <span class="o">+</span> <span class="s2">&quot; opportunity loss&quot;</span> <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]</span>
        <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loss_columns</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">loss_columns</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="mi">200</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
            <span class="n">column</span><span class="o">=</span><span class="n">loss_columns</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">)),</span>
            <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">layout</span><span class="o">=</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">options</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="study-case-1-endorsements">
<h1>Study Case 1: Endorsements<a class="headerlink" href="#study-case-1-endorsements" title="Link to this heading">#</a></h1>
<p>Nothing better than an example to understand the concepts above. Suppose I believe that, next year, Candidate X will get elected with probability 80%. I can endorse her campaign for 2 million dollars. If I don’t endorse her campaign, I get nothing. If I endorse her and she loses, I lose the 2 million dollars invested, whereas if I endorse her and she wins, I get 3 million back for an overal profit of 1 million.</p>
<p>As such my best move is to endorse her if she wins, and not if she doesn’t. Since I don’t know whether she will win or not, I have to make this choice based on probabilities. Using the class above, the first thing I need is to define the loss functions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reward_if_endorse</span><span class="p">(</span><span class="n">obs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Elected&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># Get 1 million overall if elected</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span>  <span class="c1"># Lose 2 million if not elected</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endorsement_analysis</span> <span class="o">=</span> <span class="n">ExpectedOpportunityLoss</span><span class="p">(</span>
    <span class="n">reward_functions</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Endorse&quot;</span><span class="p">:</span> <span class="n">reward_if_endorse</span><span class="p">,</span>
        <span class="s2">&quot;Don&#39;t Endorse&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">obs</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>  <span class="c1"># Known profit of 0 if no endorsment happens</span>
    <span class="p">},</span>
    <span class="n">random_inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Elected&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endorsement_analysis</span><span class="o">.</span><span class="n">add_data_points</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">endorsement_analysis</span><span class="o">.</span><span class="n">generate_metrics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                                                                                                                                                                                        | 0/2 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 2/2 [00:00&lt;00:00, 241.73it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_dcf5b_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 95.0%, transparent 95.0%);
}
#T_dcf5b_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
</style>
<table id="T_dcf5b">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_dcf5b_level0_col0" class="col_heading level0 col0" >Expected Loss</th>
      <th id="T_dcf5b_level0_col1" class="col_heading level0 col1" >Standard Deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_dcf5b_level0_row0" class="row_heading level0 row0" >Endorse</th>
      <td id="T_dcf5b_row0_col0" class="data row0 col0" >0.644000</td>
      <td id="T_dcf5b_row0_col1" class="data row0 col1" >0.934000</td>
    </tr>
    <tr>
      <th id="T_dcf5b_level0_row1" class="row_heading level0 row1" >Don't Endorse</th>
      <td id="T_dcf5b_row1_col0" class="data row1 col0" >0.678000</td>
      <td id="T_dcf5b_row1_col1" class="data row1 col1" >0.467000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We see that the the lowest expected loss is attainned if we endorse the candidate, for an expected opportunity loss of around 0.6 million if we endorse her versus an expected opportunity loss of 0.7 if we don’t endorse.</p>
<p>Note that we also have the standard deviation of our losses, since the expected loss only gives us an average value, but we can have two very different distributions for the opportunity loss. This Opportunity Loss can be thought of as a random variable as well, being a function of other random variables. We can see the distribution below</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">endorsement_analysis</span><span class="o">.</span><span class="n">plot_loss_distribution</span><span class="p">()</span>  <span class="c1"># Need to add labels and overlap the barchart1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b769e400682974ff613dda792ca8ed47875248a224c6653f0fa811b37a8a6193.png" src="../_images/b769e400682974ff613dda792ca8ed47875248a224c6653f0fa811b37a8a6193.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="study-case-2-distribution-centers">
<h1>Study Case 2: Distribution Centers<a class="headerlink" href="#study-case-2-distribution-centers" title="Link to this heading">#</a></h1>
<p>Now let us try a much harder example. Say we manage a distribution center and on any given day we distribute packages. The costs associated are described by <span class="math notranslate nohighlight">\(N_{Trucks} * M \)</span> (the number of trucks multiplied by the average maintenance costs per truck), and the profit is <span class="math notranslate nohighlight">\(\min( N_{packages}, N_{Trucks} * C ) * P\)</span>, where the first term represents the number of packages that can be handled for a given day (the minimum between the number of requests made and the capacity that the company has), and the second term represents the average profit per package. As such the overal reward function is given by:</p>
<div class="math notranslate nohighlight">
\[ \min( N_{packages}, N_{Trucks} * C ) P - M N_{Trucks}\]</div>
<p>In this equation:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N_{packages}\)</span> is the number of packages sent by clients. Assuming 10 million Portuguese possible clients, each with a probibility of 0.1% of sending a package on a given day, and independent of each other, we get that this is a random variable with a binomial distribution with parameters <span class="math notranslate nohighlight">\(n=10^7\)</span> and <span class="math notranslate nohighlight">\(p=10^{-3}\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(N_{trucks}\)</span> Is the only variable we control. Let’s assume we currently have 8 trucks, and can get a total of up to 12 trucks.</p></li>
<li><p><span class="math notranslate nohighlight">\(C\)</span> represents the truck capacity. This is currently given as <span class="math notranslate nohighlight">\(10^3\)</span>, for each truck.</p></li>
<li><p><span class="math notranslate nohighlight">\(M\)</span> is the costs per truck. Each truck costs us a fixed amount of <span class="math notranslate nohighlight">\(50€\)</span> per day, but we could potentially pay up to <span class="math notranslate nohighlight">\(500€\)</span> for repairs. As such this is uniform on the interval <span class="math notranslate nohighlight">\((50,500)\)</span>.</p></li>
</ul>
<p>As such our reward functions are given by the distinct choices we can make regarding the number of trucks, and the other variable represent random inputs. The code below represents this</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">8</span>
<span class="p">]</span>  <span class="c1"># We already have 8 trucks, and we can buy up to 12</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">reward_function</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">number_of_trucks</span><span class="p">):</span>
    <span class="n">truck_capacity</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># A truck can carry 1000 packages a day</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="nb">min</span><span class="p">([</span><span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Number of Packages&quot;</span><span class="p">],</span> <span class="n">number_of_trucks</span> <span class="o">*</span> <span class="n">truck_capacity</span><span class="p">])</span>
        <span class="o">*</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Profit per Package&quot;</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">number_of_trucks</span> <span class="o">*</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Maintenance cost per Truck&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>

<span class="n">distribution_center_analysis</span> <span class="o">=</span> <span class="n">ExpectedOpportunityLoss</span><span class="p">(</span>
    <span class="n">reward_functions</span><span class="o">=</span><span class="p">{</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> trucks&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span><span class="n">reward_function</span><span class="p">,</span> <span class="n">number_of_trucks</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">options_list</span>
    <span class="p">},</span>
    <span class="n">random_inputs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Number of Packages&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">10000000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.001</span>
        <span class="p">),</span>  <span class="c1"># There&#39;s 10 million people, each of which with .1 % chance of sending a package that day</span>
        <span class="s2">&quot;Profit per Package&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">3</span>
        <span class="p">),</span>  <span class="c1"># Package profits are exponentially distributed, with average 3 euros per package but a lower bound of 1.</span>
        <span class="s2">&quot;Maintenance cost per Truck&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="mi">50</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span>
        <span class="p">),</span>  <span class="c1"># Maintenance of trucks has a fixed cost of 50€ per truck (man work) + extra if replacements are needed</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">add_data_points</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">generate_metrics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                                                                                                                                                                                        | 0/5 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 40%|████████████████████████████████████████████████████████████████████████████▊                                                                                                                   | 2/5 [00:00&lt;00:00, 13.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 80%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                      | 4/5 [00:00&lt;00:00, 13.10it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 5/5 [00:00&lt;00:00, 12.86it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_35288/1171031813.py:80: FutureWarning: The behavior of DataFrame concatenation with empty or all-NA entries is deprecated. In a future version, this will no longer exclude empty or all-NA columns when determining the result dtypes. To retain the old behavior, exclude the relevant entries before the concat operation.
  self.data = pd.concat([self.data, new_data], ignore_index=True).astype(float)
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_22fd2_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 1.6%, transparent 1.6%);
}
#T_22fd2_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 4.5%, transparent 4.5%);
}
#T_22fd2_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 9.7%, transparent 9.7%);
}
#T_22fd2_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 49.6%, transparent 49.6%);
}
#T_22fd2_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
</style>
<table id="T_22fd2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_22fd2_level0_col0" class="col_heading level0 col0" >Expected Loss</th>
      <th id="T_22fd2_level0_col1" class="col_heading level0 col1" >Standard Deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_22fd2_level0_row0" class="row_heading level0 row0" >10 trucks</th>
      <td id="T_22fd2_row0_col0" class="data row0 col0" >84.892000</td>
      <td id="T_22fd2_row0_col1" class="data row0 col1" >231.115000</td>
    </tr>
    <tr>
      <th id="T_22fd2_level0_row1" class="row_heading level0 row1" >11 trucks</th>
      <td id="T_22fd2_row1_col0" class="data row1 col0" >244.836000</td>
      <td id="T_22fd2_row1_col1" class="data row1 col1" >216.693000</td>
    </tr>
    <tr>
      <th id="T_22fd2_level0_row2" class="row_heading level0 row2" >12 trucks</th>
      <td id="T_22fd2_row2_col0" class="data row2 col0" >521.368000</td>
      <td id="T_22fd2_row2_col1" class="data row2 col1" >315.066000</td>
    </tr>
    <tr>
      <th id="T_22fd2_level0_row3" class="row_heading level0 row3" >9 trucks</th>
      <td id="T_22fd2_row3_col0" class="data row3 col0" >2672.568000</td>
      <td id="T_22fd2_row3_col1" class="data row3 col1" >2919.943000</td>
    </tr>
    <tr>
      <th id="T_22fd2_level0_row4" class="row_heading level0 row4" >8 trucks</th>
      <td id="T_22fd2_row4_col0" class="data row4 col0" >5384.215000</td>
      <td id="T_22fd2_row4_col1" class="data row4 col1" >5880.703000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>We see that 10 trucks is the best choice, with an expected opportunity loss around 90. The next best choice, 11 trucks, has a much bigger loss, around 240.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">plot_loss_distribution</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/38d16b739ed5039433895ad92538e2fc3eeb5708d66804219f3e0bd4b148bafe.png" src="../_images/38d16b739ed5039433895ad92538e2fc3eeb5708d66804219f3e0bd4b148bafe.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_35288/1171031813.py:131: FutureWarning: The default of observed=False is deprecated and will be changed to True in a future version of pandas. Pass observed=False to retain current behavior or observed=True to adopt the future default and silence this warning.
  .groupby(groups)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|                                                                                                                                                                                                        | 0/4 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:00&lt;00:00, 1629.96it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="nn">~/.cache/pypoetry/virtualenvs/collapsedwave-FzXm3nz_-py3.12/lib/python3.12/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(cls, axis)</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>             <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_AXIS_TO_AXIS_NUMBER</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>         <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">578</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No axis named </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> for object type </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">KeyError</span>: 1

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">/tmp/ipykernel_35288/3663268095.py</span> in <span class="ni">?</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="nn">/tmp/ipykernel_35288/1171031813.py</span> in <span class="ni">?</span><span class="nt">(self, bins)</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span>         <span class="p">:</span><span class="n">param</span> <span class="n">bins</span><span class="p">:</span> <span class="n">integer</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span>         <span class="n">Number</span> <span class="n">of</span> <span class="n">bins</span> <span class="n">to</span> <span class="n">divide</span> <span class="n">the</span> <span class="n">inputs</span> <span class="ow">in</span><span class="o">.</span> <span class="n">Too</span> <span class="n">small</span> <span class="n">a</span> <span class="n">value</span> <span class="n">might</span> <span class="n">cause</span> <span class="n">you</span> <span class="n">to</span> <span class="n">miss</span> <span class="n">certain</span> <span class="n">relations</span><span class="o">.</span> <span class="n">Too</span> <span class="n">small</span> <span class="n">a</span> <span class="n">value</span> <span class="n">might</span> <span class="n">cause</span> <span class="n">you</span> <span class="n">to</span> <span class="n">overfit</span> <span class="n">to</span> <span class="n">the</span> <span class="n">data</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span><span class="sd"> </span>
<span class="ne">--&gt; </span><span class="mi">113</span><span class="sd">         savings = {</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span><span class="sd">             random_input: self.metrics.T[&quot;Expected Loss&quot;].min()</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span><span class="sd">             - self._expected_loss_given_group(</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span><span class="sd">                 pd.qcut(self.data[random_input], q=bins, duplicates=&quot;drop&quot;)</span>

<span class="nn">/tmp/ipykernel_35288/1171031813.py</span> in <span class="ni">?</span><span class="nt">(self, groups)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">139</span>         <span class="n">Returns</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">loss</span> <span class="n">assuming</span> <span class="n">we</span> <span class="n">know</span> <span class="n">exactly</span> <span class="ow">in</span> <span class="n">which</span> <span class="n">group</span> <span class="n">we</span> <span class="n">are</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">passed</span> <span class="n">Series</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span>         <span class="n">The</span> <span class="n">series</span> <span class="n">must</span> <span class="nb">map</span> <span class="n">the</span> <span class="n">indices</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">data</span> <span class="n">to</span> <span class="n">the</span> <span class="n">categorical</span> <span class="n">groups</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span><span class="w">         </span><span class="sd">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">142</span><span class="sd">         optimal_choices_per_group = self._get_optimal_choices_per_group(groups)</span>
<span class="g g-Whitespace">    </span><span class="mi">143</span><span class="sd">         return self.data.apply(</span>
<span class="g g-Whitespace">    </span><span class="mi">144</span><span class="sd">             lambda row: row[optimal_choices_per_group[groups[row.name]]], axis=1</span>
<span class="g g-Whitespace">    </span><span class="mi">145</span><span class="sd">         ).mean(axis=0)</span>

<span class="nn">/tmp/ipykernel_35288/1171031813.py</span> in <span class="ni">?</span><span class="nt">(self, groups)</span>
<span class="g g-Whitespace">    </span><span class="mi">129</span><span class="sd">         return (</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span><span class="sd">             self.data[[option + &quot; opportunity loss&quot; for option in self.options]]</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span><span class="sd">             .groupby(groups)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span><span class="sd">             .progress_apply(np.mean)</span>
<span class="ne">--&gt; </span><span class="mi">133</span><span class="sd">             .idxmin(axis=1)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span><span class="sd">             .to_dict()</span>
<span class="g g-Whitespace">    </span><span class="mi">135</span><span class="sd">         )</span>

<span class="nn">~/.cache/pypoetry/virtualenvs/collapsedwave-FzXm3nz_-py3.12/lib/python3.12/site-packages/pandas/core/series.py</span> in <span class="ni">?</span><span class="nt">(self, axis, skipna, *args, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2667</span><span class="sd"> </span>
<span class="g g-Whitespace">   </span><span class="mi">2668</span><span class="sd">         &gt;&gt;&gt; s.idxmin(skipna=False)</span>
<span class="g g-Whitespace">   </span><span class="mi">2669</span><span class="sd">         nan</span>
<span class="g g-Whitespace">   </span><span class="mi">2670</span><span class="sd">         &quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">2671</span>         <span class="n">axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_axis_number</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2672</span>         <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
<span class="g g-Whitespace">   </span><span class="mi">2673</span>             <span class="c1"># TODO(3.0): this catching/filtering can be removed</span>
<span class="g g-Whitespace">   </span><span class="mi">2674</span>             <span class="c1"># ignore warning produced by argmin since we will issue a different</span>

<span class="nn">~/.cache/pypoetry/virtualenvs/collapsedwave-FzXm3nz_-py3.12/lib/python3.12/site-packages/pandas/core/generic.py</span> in <span class="ni">?</span><span class="nt">(cls, axis)</span>
<span class="g g-Whitespace">    </span><span class="mi">574</span>     <span class="k">def</span> <span class="nf">_get_axis_number</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AxisInt</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">575</span>         <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">576</span>             <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_AXIS_TO_AXIS_NUMBER</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">577</span>         <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">578</span>             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No axis named </span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2"> for object type </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="ne">ValueError</span>: No axis named 1 for object type Series
</pre></div>
</div>
</div>
</div>
<p>Assuming we knew exactly which distribution quantile we were in for the input variables above, we can see exactly which one provides the biggest improvement in Expected Loss: Knowing the Number of Packages. As such reducing uncertainty around the Number of packages per day is more likely to reduce the expected loss.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">get_optimal_choice_per_group</span><span class="p">(</span>
    <span class="n">random_input</span><span class="o">=</span><span class="s2">&quot;Number of Packages&quot;</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/4 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 4/4 [00:00&lt;00:00, 1911.93it/s]
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Optimal Choice for Number of Packages</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>(9636.999, 9932.0]</th>
      <td>10 trucks</td>
    </tr>
    <tr>
      <th>(9932.0, 10002.0]</th>
      <td>10 trucks</td>
    </tr>
    <tr>
      <th>(10002.0, 10069.0]</th>
      <td>10 trucks</td>
    </tr>
    <tr>
      <th>(10069.0, 10371.0]</th>
      <td>11 trucks</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Looking at the optimal choice per group, we can observe that the reduction in opportunity loss comes from knowing that in the upper quantile, above roughly 10000 packages, the best option is to get 11 trucks. This makes intuitive sense: If the expected number of packages is higher, more trucks will be needed to handle the demand.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/10 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 10/10 [00:00&lt;00:00, 3181.12it/s]
  0%|          | 0/10 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 10/10 [00:00&lt;00:00, 3136.40it/s]
  0%|          | 0/10 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 10/10 [00:00&lt;00:00, 3275.78it/s]
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_5543a_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 43.2%, transparent 43.2%);
}
#T_5543a_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 31.9%, transparent 31.9%);
}
#T_5543a_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 5.6%, transparent 5.6%);
}
</style>
<table id="T_5543a">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_5543a_level0_col0" class="col_heading level0 col0" >Savings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_5543a_level0_row0" class="row_heading level0 row0" >Profit per Package</th>
      <td id="T_5543a_row0_col0" class="data row0 col0" >36.281961</td>
    </tr>
    <tr>
      <th id="T_5543a_level0_row1" class="row_heading level0 row1" >Number of Packages</th>
      <td id="T_5543a_row1_col0" class="data row1 col0" >26.765117</td>
    </tr>
    <tr>
      <th id="T_5543a_level0_row2" class="row_heading level0 row2" >Maintenance cost per Truck</th>
      <td id="T_5543a_row2_col0" class="data row2 col0" >4.729900</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>If we knew deciles, however, the picture changes: Knowing the profit per package now surpasses knowing the number of packages. This can be interpreted by thinking of marginal returns: An initial reduction in knowing the expected number of packages reduces our uncertainty significantly up to a certain amount, after which we might be better off reducing uncertainty around the Profit per package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distribution_center_analysis</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 3950.96it/s]
  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 4748.23it/s]
  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 5022.34it/s]
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_fb803_row0_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 44.1%, transparent 44.1%);
}
#T_fb803_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 32.9%, transparent 32.9%);
}
#T_fb803_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #5fba7d 7.1%, transparent 7.1%);
}
</style>
<table id="T_fb803">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_fb803_level0_col0" class="col_heading level0 col0" >Savings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_fb803_level0_row0" class="row_heading level0 row0" >Profit per Package</th>
      <td id="T_fb803_row0_col0" class="data row0 col0" >37.027284</td>
    </tr>
    <tr>
      <th id="T_fb803_level0_row1" class="row_heading level0 row1" >Number of Packages</th>
      <td id="T_fb803_row1_col0" class="data row1 col0" >27.626619</td>
    </tr>
    <tr>
      <th id="T_fb803_level0_row2" class="row_heading level0 row2" >Maintenance cost per Truck</th>
      <td id="T_fb803_row2_col0" class="data row2 col0" >5.936948</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>The above shows that even knowing the percentile of a given input is not enough for fully reducing Expected Loss. This reveals one of the limitations of this approach: It only shows improvements related to measuring one variable, while keeping the other ones with their original distribution. This misses interactions between measurements on different inputs.</p>
<p>As such we follow a greedy strategy: by the above the greatest improvement comes from measuring the Number of Packages. Afterwards we rerun this class with the new and more accurate distribution, and calculate the next cheapest measurement we can make in order to reduce uncertainty around the final decision.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="study-case-3-boeing-buybacks-decision">
<h1>Study case 3: Boeing buybacks decision<a class="headerlink" href="#study-case-3-boeing-buybacks-decision" title="Link to this heading">#</a></h1>
<p>A few years back, Boeing had a surplus of cash. As such, it had the option of buying back it’s shares. With a lerger amount of shares it would own more of it’s own profits, in the form of dividends. With more cash, the company is more robust to financial hits due to it’s extra liquidity. The question at hand is how much of it’s shares should the company buyback. The companies monetary reward is given by:</p>
<div class="math notranslate nohighlight">
\[ (M-SC) + S(1+r)^5 - KP  \]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(M\)</span> is the initial amount of money</p></li>
<li><p><span class="math notranslate nohighlight">\(S\)</span> is the amount of self owned shares / Amount of shares bought</p></li>
<li><p><span class="math notranslate nohighlight">\(r\)</span> is the company yearly average return (geometric mean)</p></li>
<li><p><span class="math notranslate nohighlight">\(C\)</span> is the current share price</p></li>
<li><p><span class="math notranslate nohighlight">\(K\)</span> is the number of kilometres flown by the fleet.</p></li>
<li><p><span class="math notranslate nohighlight">\(P\)</span> is the current cost of petrol per kilometrer flown</p></li>
<li><p>The profits come from number of tickets bought times average ticket price, plus the companies self owned shares</p></li>
<li><p>Costs include flight costs, which is the gasoline cost per mile times the average number of miles flown.</p></li>
</ul>
<p>As such the formula becomes</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">boeing_reward_function</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">amount_of_shares_bought</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># Initial amount of money: 100 million</span>
    <span class="n">boeing_share_price</span> <span class="o">=</span> <span class="mi">500000</span>  <span class="c1"># Present cost of Boeing Shares</span>
    <span class="n">value_of_shares</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">amount_of_shares_bought</span><span class="p">,</span> <span class="n">boeing_share_price</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Boeing Shares Return&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">5</span>
    <span class="p">)</span>
    <span class="n">flying_costs</span> <span class="o">=</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Kilometres flown&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Petrol Cost&quot;</span><span class="p">]</span>
    <span class="n">liquidity</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="p">(</span><span class="n">amount_of_shares_bought</span> <span class="o">*</span> <span class="n">boeing_share_price</span><span class="p">)</span> <span class="o">-</span> <span class="n">flying_costs</span>
    <span class="k">if</span> <span class="n">liquidity</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">liquidity_value</span> <span class="o">=</span> <span class="n">liquidity</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">obs</span><span class="p">[</span><span class="s2">&quot;Loan Rate&quot;</span><span class="p">])</span> <span class="o">**</span> <span class="mi">5</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">liquidity_value</span> <span class="o">=</span> <span class="n">liquidity</span>
    <span class="k">return</span> <span class="n">liquidity_value</span> <span class="o">+</span> <span class="n">value_of_shares</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>
<span class="n">boeing_analysis</span> <span class="o">=</span> <span class="n">ExpectedOpportunityLoss</span><span class="p">(</span>
    <span class="n">reward_functions</span><span class="o">=</span><span class="p">{</span>
        <span class="sa">f</span><span class="s2">&quot;Buy </span><span class="si">{</span><span class="n">number_of_shares</span><span class="si">}</span><span class="s2"> shares&quot;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span>
            <span class="n">boeing_reward_function</span><span class="p">,</span> <span class="n">amount_of_shares_bought</span><span class="o">=</span><span class="n">number_of_shares</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">number_of_shares</span> <span class="ow">in</span> <span class="n">options</span>
    <span class="p">},</span>
    <span class="n">random_inputs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;Boeing Shares Return&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span>
        <span class="p">],</span>  <span class="c1"># log normally distributed returns, with average 0 and std_dev 1</span>
        <span class="s2">&quot;Kilometres flown&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100000000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.0001</span>
        <span class="p">),</span>  <span class="c1"># The kilometres flown is binomial since it is roughly proportional to the number of kilometres people fly in total</span>
        <span class="s2">&quot;Petrol Cost&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">40</span>
        <span class="p">),</span>  <span class="c1"># The petrol cost is around 30 to 40 a barrel</span>
        <span class="s2">&quot;Loan Rate&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span>
            <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">0.3</span>
        <span class="p">),</span>  <span class="c1"># Emergency Loan Rate if the liquidity goes below zero</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boeing_analysis</span><span class="o">.</span><span class="n">add_data_points</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">boeing_analysis</span><span class="o">.</span><span class="n">generate_metrics</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 5/5 [00:00&lt;00:00, 10.00it/s]
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_39180_row0_col0 {
  width: 10em;
}
#T_39180_row1_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 25.0%, transparent 25.0%);
}
#T_39180_row2_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 50.0%, transparent 50.0%);
}
#T_39180_row3_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 75.0%, transparent 75.0%);
}
#T_39180_row4_col0 {
  width: 10em;
  background: linear-gradient(90deg, #d65f5f 100.0%, transparent 100.0%);
}
</style>
<table id="T_39180">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_39180_level0_col0" class="col_heading level0 col0" >Expected Loss</th>
      <th id="T_39180_level0_col1" class="col_heading level0 col1" >Standard Deviation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_39180_level0_row0" class="row_heading level0 row0" >Buy 1 shares</th>
      <td id="T_39180_row0_col0" class="data row0 col0" >0.000000</td>
      <td id="T_39180_row0_col1" class="data row0 col1" >0.000000</td>
    </tr>
    <tr>
      <th id="T_39180_level0_row1" class="row_heading level0 row1" >Buy 2 shares</th>
      <td id="T_39180_row1_col0" class="data row1 col0" >1274755.242000</td>
      <td id="T_39180_row1_col1" class="data row1 col1" >302286.475000</td>
    </tr>
    <tr>
      <th id="T_39180_level0_row2" class="row_heading level0 row2" >Buy 3 shares</th>
      <td id="T_39180_row2_col0" class="data row2 col0" >2549510.484000</td>
      <td id="T_39180_row2_col1" class="data row2 col1" >604572.951000</td>
    </tr>
    <tr>
      <th id="T_39180_level0_row3" class="row_heading level0 row3" >Buy 4 shares</th>
      <td id="T_39180_row3_col0" class="data row3 col0" >3824265.726000</td>
      <td id="T_39180_row3_col1" class="data row3 col1" >906859.426000</td>
    </tr>
    <tr>
      <th id="T_39180_level0_row4" class="row_heading level0 row4" >Buy 5 shares</th>
      <td id="T_39180_row4_col0" class="data row4 col0" >5099020.968000</td>
      <td id="T_39180_row4_col1" class="data row4 col1" >1209145.902000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boeing_analysis</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Boeing Shares Return</th>
      <th>Kilometres flown</th>
      <th>Petrol Cost</th>
      <th>Loan Rate</th>
      <th>Buy 1 shares</th>
      <th>Buy 2 shares</th>
      <th>Buy 3 shares</th>
      <th>Buy 4 shares</th>
      <th>Buy 5 shares</th>
      <th>Buy 1 shares opportunity loss</th>
      <th>Buy 2 shares opportunity loss</th>
      <th>Buy 3 shares opportunity loss</th>
      <th>Buy 4 shares opportunity loss</th>
      <th>Buy 5 shares opportunity loss</th>
      <th>Optimal Decision</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>19.08</td>
      <td>10066.0</td>
      <td>32.57</td>
      <td>0.20</td>
      <td>-2.06e+06</td>
      <td>-3.30e+06</td>
      <td>-4.54e+06</td>
      <td>-5.78e+06</td>
      <td>-7.03e+06</td>
      <td>0.0</td>
      <td>1.24e+06</td>
      <td>2.48e+06</td>
      <td>3.73e+06</td>
      <td>4.97e+06</td>
      <td>-2.06e+06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>19.09</td>
      <td>10107.0</td>
      <td>35.05</td>
      <td>0.28</td>
      <td>-2.99e+06</td>
      <td>-4.73e+06</td>
      <td>-6.48e+06</td>
      <td>-8.23e+06</td>
      <td>-9.98e+06</td>
      <td>0.0</td>
      <td>1.75e+06</td>
      <td>3.50e+06</td>
      <td>5.24e+06</td>
      <td>6.99e+06</td>
      <td>-2.99e+06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>19.09</td>
      <td>10053.0</td>
      <td>39.54</td>
      <td>0.15</td>
      <td>-1.78e+06</td>
      <td>-2.76e+06</td>
      <td>-3.75e+06</td>
      <td>-4.74e+06</td>
      <td>-5.73e+06</td>
      <td>0.0</td>
      <td>9.89e+05</td>
      <td>1.98e+06</td>
      <td>2.97e+06</td>
      <td>3.96e+06</td>
      <td>-1.78e+06</td>
    </tr>
    <tr>
      <th>3</th>
      <td>19.09</td>
      <td>9917.0</td>
      <td>38.77</td>
      <td>0.14</td>
      <td>-1.72e+06</td>
      <td>-2.69e+06</td>
      <td>-3.65e+06</td>
      <td>-4.62e+06</td>
      <td>-5.59e+06</td>
      <td>0.0</td>
      <td>9.70e+05</td>
      <td>1.94e+06</td>
      <td>2.91e+06</td>
      <td>3.88e+06</td>
      <td>-1.72e+06</td>
    </tr>
    <tr>
      <th>4</th>
      <td>19.08</td>
      <td>10049.0</td>
      <td>36.54</td>
      <td>0.24</td>
      <td>-2.57e+06</td>
      <td>-4.05e+06</td>
      <td>-5.53e+06</td>
      <td>-7.02e+06</td>
      <td>-8.50e+06</td>
      <td>0.0</td>
      <td>1.48e+06</td>
      <td>2.96e+06</td>
      <td>4.45e+06</td>
      <td>5.93e+06</td>
      <td>-2.57e+06</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boeing_analysis</span><span class="o">.</span><span class="n">plot_loss_distribution</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ea3ebc46d1fac817227b293896fd404e388be37c3de2e6f38ba33afacba2e608.png" src="../_images/ea3ebc46d1fac817227b293896fd404e388be37c3de2e6f38ba33afacba2e608.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boeing_analysis</span><span class="o">.</span><span class="n">evaluate_value_of_uncertainty_reduction</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 5176.43it/s]
  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 4647.33it/s]
  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 4508.79it/s]
  0%|          | 0/100 [00:00&lt;?, ?it/s]/opt/conda/lib/python3.10/site-packages/numpy/core/fromnumeric.py:3472: FutureWarning: In a future version, DataFrame.mean(axis=None) will return a scalar mean over the entire DataFrame. To retain the old behavior, use &#39;frame.mean(axis=0)&#39; or just &#39;frame.mean()&#39;
  return mean(axis=axis, dtype=dtype, out=out, **kwargs)
100%|██████████| 100/100 [00:00&lt;00:00, 4593.18it/s]
/opt/conda/lib/python3.10/site-packages/pandas/io/formats/style.py:4152: RuntimeWarning: invalid value encountered in double_scalars
  end = (x - left) / (right - left)
</pre></div>
</div>
<div class="output text_html"><style type="text/css">
#T_e0ba1_row0_col0, #T_e0ba1_row1_col0, #T_e0ba1_row2_col0, #T_e0ba1_row3_col0 {
  width: 10em;
}
</style>
<table id="T_e0ba1">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e0ba1_level0_col0" class="col_heading level0 col0" >Savings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e0ba1_level0_row0" class="row_heading level0 row0" >Boeing Shares Return</th>
      <td id="T_e0ba1_row0_col0" class="data row0 col0" >0.000000</td>
    </tr>
    <tr>
      <th id="T_e0ba1_level0_row1" class="row_heading level0 row1" >Kilometres flown</th>
      <td id="T_e0ba1_row1_col0" class="data row1 col0" >0.000000</td>
    </tr>
    <tr>
      <th id="T_e0ba1_level0_row2" class="row_heading level0 row2" >Loan Rate</th>
      <td id="T_e0ba1_row2_col0" class="data row2 col0" >0.000000</td>
    </tr>
    <tr>
      <th id="T_e0ba1_level0_row3" class="row_heading level0 row3" >Petrol Cost</th>
      <td id="T_e0ba1_row3_col0" class="data row3 col0" >0.000000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="do-you-have-another-study-case-reach-out-for-us-to-discuss-it">
<h1>Do you have another study case? Reach out for us to discuss it<a class="headerlink" href="#do-you-have-another-study-case-reach-out-for-us-to-discuss-it" title="Link to this heading">#</a></h1>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Scribbles"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Expectations.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Expectations</p>
      </div>
    </a>
    <a class="right-next"
       href="MedicalTestAccuracy.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Medical Test Accuracy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Expected Opportunity Loss</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-1-endorsements">Study Case 1: Endorsements</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-2-distribution-centers">Study Case 2: Distribution Centers</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#study-case-3-boeing-buybacks-decision">Study case 3: Boeing buybacks decision</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#do-you-have-another-study-case-reach-out-for-us-to-discuss-it">Do you have another study case? Reach out for us to discuss it</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Miguel Torres Costa
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>